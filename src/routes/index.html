<svelte:head>
	<title>Sapper project template</title>
</svelte:head>

<div ref:map id="mapid"></div>

<style>
	#mapid {
    height: 100vh;
    width: 100vw;
  }
</style>

<script>
	import 'leaflet/dist/leaflet.css'
	let isBrowser = new Function("try {return this===window;}catch(e){ return false;}");

  export default {
    async oncreate() {
      if (isBrowser()) {
        let { default: { Map, tileLayer, circle, marker }} = await import('leaflet')
        let map = new Map(this.refs.map, {
        })
        let m,c,last
        map.on('locationfound', e => {
          last = e
          var radius = e.accuracy / 2;
          if (m) m.remove()
          m = marker(e.latlng).addTo(map).bindPopup(radius + " meters").openPopup();
          if (c) c.remove()
          c = circle(e.latlng, radius).addTo(map);
        });
        map.locate({watch: true, setView: true, enableHighAccuracy: true})
        tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {}).addTo(map);
      }
    }
  };
</script>